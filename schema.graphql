type Hub @entity {
  id: ID! # The namehash of the name
  owner: Safe!
}

type Token @entity {
  id: ID! # The namehash of the name
  owner: Safe!
}

type User @entity {
  id: ID!
  safe: Safe!
}

type Safe @entity {
  id: ID!
  owners: [User!]! @derivedFrom(field: "safe")
  outgoing: [Trust!]! @derivedFrom(field: "user")
  incoming: [Trust!]! @derivedFrom(field: "canSendTo")
  balances: [Balance!]! @derivedFrom(field: "owner")
}

type Balance @entity {
  id: ID!
  amount: BigInt!
  owner: Safe!
  token: Token!
}

interface Event {
  id: ID! # Concatenation of block number and log ID
}

type Signup implements Event @entity {
  id: ID!
  safe: String!
  token: String!
}

type Trust implements Event @entity {
  id: ID!
  canSendTo: Safe!
  user: Safe!
  limit: BigInt!
  limitPercentage: BigInt!
}

type ProxyCreation implements Event @entity {
  id: ID!
}

enum NotificationType {
  OWNERSHIP
  TRANSFER
  TRUST
}

type TrustChange implements Event @entity {
  id: ID!
  canSendTo: String!
  user: String!
  limitPercentage: BigInt!
}

type HubTransfer implements Event @entity {
  id: ID!
  from: String!
  to: String!
  amount: BigInt!
}

type OwnershipChange implements Event @entity {
  id: ID!
  adds: String
  removes: String
}

type Notification implements Event @entity {
  id: ID!
  safe: Safe!
  type: NotificationType!
  time: BigInt!
  transactionHash: String!
  trust: TrustChange
  transfer: HubTransfer
  ownership: OwnershipChange
}
